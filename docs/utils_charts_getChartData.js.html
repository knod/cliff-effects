<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: utils/charts/getChartData.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: utils/charts/getChartData.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import _ from 'lodash';
import { PROGRAM_CHART_VALUES } from '../../utils/charts/PROGRAM_CHART_VALUES';

// LOGIC
import { getSection8Benefit } from '../../programs/massachusetts/section8';
import { getSNAPBenefits } from '../../programs/federal/snap';


/** Order in which benefits must be run to affect
 *     each other correctly. @todo Store this
 *     where it can be easily edited by non-coders
 */
var benefitOrder = [
  `income`,
  `section8`,
  `snap`,
];

/** Container for functions so we can access them
 *     as we iterate.
 */
var getBenefit = {
  income: {
    getSubsidy: function (client, timeframe) {
      return client.future.earned;
    },
    getProps: function () {
      return {};
    },
  },
  section8: {
    getSubsidy: getSection8Benefit,
    getProps:   function (client, newSubsidy) {
      return { rentShare: client.future.contractRent - newSubsidy };
    },
  },
  snap: {
    getSubsidy: getSNAPBenefits,
    getProps:   function (client, newSubsidy) {
      return {};
    },
  },
};

/** Returns various arrays of values over change in income */
var getData = {};

getData.income = function (xRange, client, multiplier) {
  return xRange;
};  // End getData.income

getData.snap = function (xRange, client, multiplier) {

  var data = xRange.map(function (income) {
    client.future.earned = income / multiplier;  // Turn it back into monthly
    return getSNAPBenefits(client, 'future') * multiplier;
  });

  return data;
};  // End getData.snap


getData.section8 = function (xRange, client, multiplier) {

  // How the heck did I calculate subsidy amount for the past
  // considering I only know the current subsidy amount? I'm
  // worried about that.
  var data = xRange.map(function (income) {
    // New renting data
    client.future.earned  = income / multiplier;  // Turn it back into monthly
    var monthlySubsidy    = getSection8Benefit(client, 'future');
    return monthlySubsidy * multiplier;
  });

  return data;
};  // End getData.section8()

/** Mutates `benefitDatasets` items to push new data onto
 *     their `.data` prop.
 * 
 * @todo Research how to jsdoc arrays of objects
 *
 * @param {array} xRange All income values to be included.
 * @param {object} clone Clone of the client object
 * @param {object} clone.future
 * @param {object} clone.client
 * @param {float} multiplier Adjusts income and data
 *     values (meant to adjust to weekly, monthly, and yearly amounts)
 * @param {array} benefitDatasets List of datasets, one for
 *     each benefit.
 * @param {object} benefitDatasets[n]
 * @param {string} benefitDatasets[n].name Name of the benefit
 * @param {array} benefitDatasets[n].data List to which output
 *     will be pushed.
 * 
 * @returns undefined
 */
const insertBenefitData = function (xRange, clone, multiplier, benefitDatasets) {

  // Don't loop if there's nothing to do
  if (benefitDatasets.length === 0) {
    return;
  }

  // Otherwise, loop over incomes
  for (var incomei = 0; incomei &lt; xRange.length; incomei++) {
    var income = xRange[ incomei ];
    clone.future.earned = income / multiplier;

    // Datasets need to be in correct order for benefits to
    // affect each other corrrectly.
    for (let benefiti = 0; benefiti &lt; benefitDatasets.length; benefiti++) {

      let dataset = benefitDatasets[ benefiti ],
          name    = dataset.benefitName,
          funcs   = getBenefit[ name ];

      let monthlyAmount = funcs.getSubsidy(clone, `future`);
      dataset.data.push(monthlyAmount * multiplier);

      // Mutate the clone in whatever way is appropriate for
      // that program.
      let newPropValues = funcs.getProps(clone, monthlyAmount);
      Object.assign(clone.future, newPropValues);

    }  // end for each benefit, in order

  }  // end for all incomes

  return;
};  // End insertBenefitData()


/** Returns the graph data formated in a way our graph library understands.
 * 
 * @param {array} activeBenefits List of active benefits. @todo - use object instead?
 * */
const getDatasets = function (xRange, client, multiplier, activeBenefits, extraProps) {

  // Don't want to change actual client's data
  var clone    = _.cloneDeep(client),
      datasets = [];

  for (let benefiti = 0; benefiti &lt; benefitOrder.length; benefiti++) {

    let benefitName = benefitOrder[ benefiti ];

    if (activeBenefits.indexOf(benefitName) > -1) {

      var graphFrosting = PROGRAM_CHART_VALUES[ benefitName ];

      datasets.push({
        benefitName:     benefitName,
        label:           graphFrosting.name,
        backgroundColor: graphFrosting.color,
        borderColor:     graphFrosting.color,
        data:            [],  // Will be populated later
        ...extraProps[ benefitName ],  // Override other props
      });
    }
  }  // end for benefits (in correct order)

  // Mutates each `.data` prop for each benefit
  insertBenefitData(xRange, clone, multiplier, datasets);

  return datasets;
};  // End getDatasets()


export {
  benefitOrder,
  getBenefit,
  getData,
  insertBenefitData,
  getDatasets,
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BrowserLeaveListener.html">BrowserLeaveListener</a></li><li><a href="Confirmer.html">Confirmer</a></li><li><a href="CustomClient.html">CustomClient</a></li><li><a href="ErrorListener.html">ErrorListener</a></li><li><a href="FeedbackPrompt.html">FeedbackPrompt</a></li><li><a href="HeadingWithDetail.html">HeadingWithDetail</a></li><li><a href="ManagedNumberField.html">ManagedNumberField</a></li><li><a href="ReactRouterLeaveListener.html">ReactRouterLeaveListener</a></li><li><a href="RowWithDetail.html">RowWithDetail</a></li><li><a href="ShowOnYes.html">ShowOnYes</a></li><li><a href="VerticalLine.html">VerticalLine</a></li></ul><h3>Global</h3><ul><li><a href="global.html#AboutContent">AboutContent</a></li><li><a href="global.html#applySideEffects">applySideEffects</a></li><li><a href="global.html#benefitOrder">benefitOrder</a></li><li><a href="global.html#BigButton">BigButton</a></li><li><a href="global.html#CashFlowContainer">CashFlowContainer</a></li><li><a href="global.html#CashFlowInputsRow">CashFlowInputsRow</a></li><li><a href="global.html#CLIENT_DEFAULTS">CLIENT_DEFAULTS</a></li><li><a href="global.html#ColumnHeader">ColumnHeader</a></li><li><a href="global.html#ColumnHeading">ColumnHeading</a></li><li><a href="global.html#ContentH1">ContentH1</a></li><li><a href="global.html#ContentSubH1">ContentSubH1</a></li><li><a href="global.html#ControlledRadioYesNo">ControlledRadioYesNo</a></li><li><a href="global.html#CurrentBenefitsContent">CurrentBenefitsContent</a></li><li><a href="global.html#CurrentBenefitsStep">CurrentBenefitsStep</a></li><li><a href="global.html#CurrentExpensesStep">CurrentExpensesStep</a></li><li><a href="global.html#CurrentIncomeStep">CurrentIncomeStep</a></li><li><a href="global.html#EarnedFrom">EarnedFrom</a></li><li><a href="global.html#empty">empty</a></li><li><a href="global.html#ExpensesFormContent">ExpensesFormContent</a></li><li><a href="global.html#ExternalLink">ExternalLink</a></li><li><a href="global.html#FormBottomRow">FormBottomRow</a></li><li><a href="global.html#FormPartsContainer">FormPartsContainer</a></li><li><a href="global.html#getBenefit">getBenefit</a></li><li><a href="global.html#getBenefitTimeFrames">getBenefitTimeFrames</a></li><li><a href="global.html#getData">getData</a></li><li><a href="global.html#getDatasets">getDatasets</a></li><li><a href="global.html#getDependentCostsMonthly">getDependentCostsMonthly</a></li><li><a href="global.html#getEveryMember">getEveryMember</a></li><li><a href="global.html#getEveryMemberOfHousehold">getEveryMemberOfHousehold</a></li><li><a href="global.html#getExtraAmount">getExtraAmount</a></li><li><a href="global.html#getGrossUnearnedIncomeMonthly">getGrossUnearnedIncomeMonthly</a></li><li><a href="global.html#getLimitBySize">getLimitBySize</a></li><li><a href="global.html#getMaxIntKey">getMaxIntKey</a></li><li><a href="global.html#getMembers">getMembers</a></li><li><a href="global.html#getSection8Benefit">getSection8Benefit</a></li><li><a href="global.html#getSimpleGrossIncomeMonthly">getSimpleGrossIncomeMonthly</a></li><li><a href="global.html#getSNAPBenefits">getSNAPBenefits</a></li><li><a href="global.html#getTextForLanguage">getTextForLanguage</a></li><li><a href="global.html#getUnder13Expenses">getUnder13Expenses</a></li><li><a href="global.html#hasOnlyNonNegNumberChars">hasOnlyNonNegNumberChars</a></li><li><a href="global.html#hasOnlyNonNegWholeNumberChars">hasOnlyNonNegWholeNumberChars</a></li><li><a href="global.html#HouseholdContent">HouseholdContent</a></li><li><a href="global.html#HouseholdStep">HouseholdStep</a></li><li><a href="global.html#Housing">Housing</a></li><li><a href="global.html#IncomeForm">IncomeForm</a></li><li><a href="global.html#insertBenefitData">insertBenefitData</a></li><li><a href="global.html#interpolateSnippets">interpolateSnippets</a></li><li><a href="global.html#interpolateText">interpolateText</a></li><li><a href="global.html#IntervalColumnHeadings">IntervalColumnHeadings</a></li><li><a href="global.html#InvalidMessage">InvalidMessage</a></li><li><a href="global.html#isDependent">isDependent</a></li><li><a href="global.html#isNonNegNumber">isNonNegNumber</a></li><li><a href="global.html#isNonNegWholeNumber">isNonNegWholeNumber</a></li><li><a href="global.html#limit">limit</a></li><li><a href="global.html#MemberButton">MemberButton</a></li><li><a href="global.html#MemberField">MemberField</a></li><li><a href="global.html#mergeCustomizer">mergeCustomizer</a></li><li><a href="global.html#moneyToWholeNum">moneyToWholeNum</a></li><li><a href="global.html#MonthlyCashFlowRow">MonthlyCashFlowRow</a></li><li><a href="global.html#PredictionsStep">PredictionsStep</a></li><li><a href="global.html#RenderIfTrue">RenderIfTrue</a></li><li><a href="global.html#returnSame">returnSame</a></li><li><a href="global.html#Role">Role</a></li><li><a href="global.html#sampleClients">sampleClients</a></li><li><a href="global.html#SpaceHolder">SpaceHolder</a></li><li><a href="global.html#StackedBarGraph">StackedBarGraph</a></li><li><a href="global.html#sum">sum</a></li><li><a href="global.html#sumProps">sumProps</a></li><li><a href="global.html#toBoolean">toBoolean</a></li><li><a href="global.html#toMoneyStr">toMoneyStr</a></li><li><a href="global.html#toMonthlyFrom">toMonthlyFrom</a></li><li><a href="global.html#toWeeklyFrom">toWeeklyFrom</a></li><li><a href="global.html#toYearlyFrom">toYearlyFrom</a></li><li><a href="global.html#undefinedString">undefinedString</a></li><li><a href="global.html#UNDER13_NON_TRANSPORT_CARE">UNDER13_NON_TRANSPORT_CARE</a></li><li><a href="global.html#UNEARNED_INCOME_SOURCES">UNEARNED_INCOME_SOURCES</a></li><li><a href="global.html#valueFixers">valueFixers</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Thu Sep 13 2018 08:42:54 GMT-0400 (EDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
